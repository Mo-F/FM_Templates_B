<'
lang c

# check arguments
if {[llength $argv] != 2} { error "expected arguments: component types" }
lassign $argv component types


# compute handy shortcuts
set comp [$component name]

if {[catch {$component doc} doc]} {
  set doc $comp
}
set brief [lindex [split $doc "\n"] 0]

# quote for xml
proc quote { string } {
  string map {
    \" &quot; ' &apos;
    < &lt; > &gt;
    & &amp;
  } $string
}
'>
<package>
  <description brief="<"[quote $brief]">" >
<"[quote $doc]">
  </description>
<'if {![catch {dotgen input notice} notice]} {'>
  <license><"[quote $notice]"></license>
<'}'>
<'if {![catch {$component email} email]} {'>
  <author><"$email"></author>
<'}'>
  <depend package="roscpp"/>
  <depend package="std_msgs"/>
  <depend package="actionlib"/>
  <depend package="actionlib_msgs"/>
<'foreach t $types {'>
<'  if {![catch {$t masquerade ros} masquerade]} {'>
  <depend package="<"[lindex [split $masquerade /] 0]">"/>
<'  }'>
<'}'>
</package>
